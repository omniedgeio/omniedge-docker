services:
  # Edge mode - VPN client
  # docker compose run --rm omniedge-edge
  omniedge-edge:
    image: omniedge/omniedge:latest
    container_name: omniedge
    privileged: true
    network_mode: host
    command: ["edge", "-n", "${OMNIEDGE_NETWORK_ID}", "-s", "${OMNIEDGE_SECURITY_KEY}"]
    volumes:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - NET_ADMIN

  # Nucleus mode - Signaling server
  # docker compose run --rm omniedge-nucleus
  omniedge-nucleus:
    image: omniedge/omniedge:latest
    container_name: omniedge-nucleus
    network_mode: host
    command: ["nucleus", "--secret", "${OMNIEDGE_SECRET}", "--port", "${OMNIEDGE_PORT:-51820}"]

  # Dual mode - VPN + Signaling
  # docker compose run --rm omniedge-dual
  omniedge-dual:
    image: omniedge/omniedge:latest
    container_name: omniedge-dual
    privileged: true
    network_mode: host
    command: ["dual", "-n", "${OMNIEDGE_NETWORK_ID}", "-s", "${OMNIEDGE_SECURITY_KEY}", "--secret", "${OMNIEDGE_SECRET}"]
    volumes:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - NET_ADMIN
